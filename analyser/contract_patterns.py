from analyser.legal_docs import rectifyed_sum_by_pattern_prefix
from analyser.ml_tools import max_exclusive_pattern_by_prefix, momentum, cut_above, relu
from analyser.patterns import AbstractPatternFactoryLowCase
from analyser.structures import ContractSubject

contract_headlines_patterns = {
  '–ö–£–ü–õ–ò-–ü–†–û–î–ê–ñ–ò –ù–ï–î–í–ò–ñ–ò–ú–û–ì–û –ò–ú–£–©–ï–°–¢–í–ê': ContractSubject.RealEstate,
  '–ö–£–ü–õ–ò-–ü–†–û–î–ê–ñ–ò –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò': ContractSubject.RealEstate,

  '–ü–û–°–¢–ê–í–ö–ò': ContractSubject.Deal,
  '–õ–ò–¶–ï–ù–ó–ò–û–ù–ù–´–ô': ContractSubject.Deal,
  '–°–£–ë–õ–ò–¶–ï–ù–ó–ò–û–ù–ù–´–ô': ContractSubject.Deal,

  '–∑–∞–π–º–∞': ContractSubject.Loans,

  '–∞–≥–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è': ContractSubject.AgencyContract,
  '–∞–≥–µ–Ω—Ç—Å–∫–∏–π': ContractSubject.AgencyContract,

  '–æ–∫–∞–∑–∞–Ω–∏—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥': ContractSubject.Service,
  '–Ω–∞ –æ–∫–∞–∑–∞–Ω–∏–µ —É—Å–ª—É–≥': ContractSubject.Service,
  '–í–û–ó–ú–ï–ó–î–ù–û–ì–û –û–ö–ê–ó–ê–ù–ò–Ø –£–°–õ–£–ì': ContractSubject.Service,
  '–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º': ContractSubject.Service,
  '–ù–ê –í–´–ü–û–õ–ù–ï–ù–ò–ï –ò–ù–ñ–ï–ù–ï–†–ù–û-–ò–ó–´–°–ö–ê–¢–ï–õ–¨–°–ö–ò–• –†–ê–ë–û–¢': ContractSubject.Service,
  '–ù–ê –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï –ò –†–ï–ú–û–ù–¢': ContractSubject.Service,
  '–ù–ê –†–∞–∑—Ä–∞–±–æ—Ç–∫—É': ContractSubject.Service,

  '–∑–∞–ª–æ–≥–∞': ContractSubject.PledgeEncumbrance,

  '–æ –±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ–π –ø–æ–º–æ—â–∏ ( –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ )': ContractSubject.Charity,
  '–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è': ContractSubject.Charity,
  '—Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è': ContractSubject.Charity,
  '–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏': ContractSubject.Charity,
  '–î–ê–†–ï–ù–ò–Ø': ContractSubject.Charity,
  '–¥–∞—Ä–µ–Ω–∏—è –¥–≤–∏–∂–∏–º–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞': ContractSubject.Charity,
  '–±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–∂–∏–ª—ã–º –ø–æ–º–µ—â–µ–Ω–∏–µ–º': ContractSubject.Charity,

  '–≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ä—è–¥–∞': ContractSubject.GeneralContract,
  '–ø–æ–¥—Ä—è–¥–∞': ContractSubject.GeneralContract,

  '–∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞': ContractSubject.Renting,
  '–∞—Ä–µ–Ω–¥—ã': ContractSubject.Renting,

  '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è': ContractSubject.Insurance
}
head_subject_patterns_prefix = 'hds_'


class ContractPatternFactory(AbstractPatternFactoryLowCase):

  def __init__(self, embedder=None):
    AbstractPatternFactoryLowCase.__init__(self)
    # self.headlines = ['subj', 'contract', 'def', 'price.', 'pricecond', 'terms', 'dates', 'break', 'rights', 'obl',
    #                   'resp', 'forcemajor', 'security', 'special', 'appl', 'addresses', 'conficts']

    self.headlines = ['subj', 'contract', 'cvalue', 'pricecond', 'dates',
                      'resp', 'forcemajor', 'security', 'appl', 'addresses', 'conficts', 'obl']

    self._build_head_patterns()
    self._build_head_subject_patterns()
    self._build_sum_patterns()
    self._build_subject_patterns()

    if embedder is not None:
      self.embedd(embedder)

  def _build_head_subject_patterns(self):

    for txt in contract_headlines_patterns:
      cnt = len(self.patterns)
      self.create_pattern(f'{head_subject_patterns_prefix}{contract_headlines_patterns[txt]}.{cnt}',
                          ('–î–æ–≥–æ–≤–æ—Ä', txt.lower(), ''))

  def _build_head_patterns(self):
    def cp(name, tuples):
      return self.create_pattern(name, tuples)

    p_r_f_x = ''

    cp('headline.contract', (p_r_f_x, '–î–û–ì–û–í–û–†',
                             '\n –≥–æ—Ä–æ–¥, –º–µ—Å—è—Ü, –≥–æ–¥ \n –æ–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é, –≤ –ª–∏—Ü–µ, –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏, –∏–º–µ–Ω—É–µ–º–æ–µ –¥–∞–ª–µ–µ, –∑–∞–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä –æ –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º'))
    cp('headline.def', (p_r_f_x, '–¢–µ—Ä–º–∏–Ω—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è', '—Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è'))

    cp('headline.subj.1', ('–¥–æ–≥–æ–≤–æ—Ä–∞ –∑–∞–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –î–æ–≥–æ–≤–æ—Ä –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º:', '–ü—Ä–µ–¥–º–µ—Ç ',
                           '–¥–æ–≥–æ–≤–æ—Ä–∞:\n –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è, –∑–∞–∫–∞–∑—á–∏–∫ –ø–æ—Ä—É—á–∞–µ—Ç'))
    cp('headline.subj.2', (p_r_f_x, '–ü–†–ï–î–ú–ï–¢', '–î–û–ì–û–í–û–†–ê'))
    cp('headline.subj.3', ('–∑–∞–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä –æ –Ω–∏–∂–µ—Å–ª–µ–¥—É—é—â–µ–º', '–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è', ''))

    cp('headline.cvalue.1', (p_r_f_x, '—Ü–µ–Ω–∞', '–¥–æ–≥–æ–≤–æ—Ä–∞'))
    cp('headline.cvalue.2', (p_r_f_x, '–°–¢–û–ò–ú–û–°–¢–¨', '–†–ê–ë–û–¢'))
    cp('headline.cvalue.3', (p_r_f_x, ' –†–∞—Å—á–µ—Ç—ã', '–ø–æ –¥–æ–≥–æ–≤–æ—Ä—É'))
    cp('headline.cvalue.4', (p_r_f_x, '–û–ø–ª–∞—Ç–∞', '—É—Å–ª—É–≥'))
    cp('headline.cvalue.5',
       ('–ø–æ—Ä—è–¥–æ–∫ –∏ —Å—Ä–æ–∫–∏', '–æ–ø–ª–∞—Ç—ã', '—Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞—é—Ç—Å—è –°—Ç–æ—Ä–æ–Ω–∞–º–∏ –≤ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–≥–ª–∞—à–µ–Ω–∏—è—Ö –∫ –Ω–∞—Å—Ç–æ—è—â–µ–º—É'))

    cp('headline.pricecond.1', ('–£–°–õ–û–í–ò–Ø ', '–ü–õ–ê–¢–ï–ñ–ï–ô', ''))
    cp('headline.pricecond.3', ('–£—Å–ª–æ–≤–∏—è –∏ –ø–æ—Ä—è–¥–æ–∫', '—Ä–∞—Å—á–µ—Ç–æ–≤.', ''))
    cp('headline.pricecond.4', (p_r_f_x, '–°–¢–û–ò–ú–û–°–¢–¨', '–£–°–õ–£–ì, –ü–û–†–Ø–î–û–ö –ò–• –ü–†–ò–ï–ú–ö–ò –ò –†–ê–°–ß–ï–¢–û–í'))
    cp('headline.pricecond.5', (' –ê–†–ï–ù–î–ù–ê–Ø', '–ü–õ–ê–¢–ê', '–ü–û–†–Ø–î–û–ö –í–ù–ï–°–ï–ù–ò–Ø –ê–†–ï–ù–î–ù–û–ô –ü–õ–ê–¢–´'))

    cp('headline.dates.1', (p_r_f_x, '–°–†–û–ö–ò.', '–í–´–ü–û–õ–ù–ï–ù–ò–Ø –†–ê–ë–û–¢. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç.'))

    cp('headline.dates.2', (p_r_f_x, '–°–†–û–ö',
                            '–î–ï–ô–°–¢–í–ò–Ø. \n –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–≥–æ–≤–æ—Ä –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω–∞–º–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –¥–æ–≥–æ–≤–æ—Ä—É –æ—Ñ–æ—Ä–º–ª—è—é—Ç—Å—è –ø–∏—Å—å–º–µ–Ω–Ω—ã–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º —Å—Ç–æ—Ä–æ–Ω, –ø—Ä–æ–¥–ª–µ–Ω–Ω—ã–º –Ω–∞ –∫–∞–∂–¥—ã–π –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –≥–æ–¥'))

    cp('headline.break', (p_r_f_x, '–†–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ',
                          '–¥–æ–≥–æ–≤–æ—Ä–∞. \n –¥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–∏, —Ä–∞—Å—Ç–æ—Ä–≥–∞–µ—Ç—Å—è –≤ —Å–ª—É—á–∞—è—Ö, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º, –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ'))

    # –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω
    cp('headline.obl.1', (p_r_f_x, '–ø—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏', '—Å—Ç–æ—Ä–æ–Ω.\n'))

    cp('headline.obl.2', (p_r_f_x, '–û–ë–Ø–ó–ê–¢–ï–õ–¨–°–¢–í–ê', '—Å—Ç–æ—Ä–æ–Ω.\n'))
    cp('headline.obl.3', (p_r_f_x, '–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏', '—Å—Ç–æ—Ä–æ–Ω'))

    cp('headline.obl.4', (p_r_f_x, '–ì–ê–†–ê–ù–¢–ò–ô–ù–´–ï', '–û–ë–Ø–ó–ê–¢–ï–õ–¨–°–¢–í–ê.'))

    cp('headline.resp', (p_r_f_x, '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω.\n',
                         '–Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–æ–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤, –Ω–µ—Å—É—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–µ–π—Å—Ç–≤—É—é—â–∏–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º'))

    # –§–û–†–° - –ú–ê–ñ–û–†
    cp('headline.forcemajor.1', (p_r_f_x, '–ù–ï–ü–†–ï–û–î–û–õ–ò–ú–ê–Ø –°–ò–õ–ê.', '–§–û–†–°-–ú–ê–ñ–û–†–ù–´–ï –û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê'))
    cp('headline.forcemajor.2', (p_r_f_x, '–û–ë–°–¢–û–Ø–¢–ï–õ–¨–°–¢–í–ê –ù–ï–ü–†–ï–û–î–û–õ–ò–ú–û–ô –°–ò–õ–´', ''))

    # –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨
    cp('headline.security.1', (p_r_f_x, '–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨ –ò–ù–§–û–†–ú–ê–¶–ò–ò.', ''))
    cp('headline.security.2', (p_r_f_x, '–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨', ''))

    cp('headline.special.1', (p_r_f_x + '–û–°–û–ë–´–ï, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ', ' –£–°–õ–û–í–ò–Ø.', ''))
    cp('headline.special.2', (p_r_f_x, '–ó–ê–ö–õ–Æ–ß–ò–¢–ï–õ–¨–ù–´–ï –ü–û–õ–û–ñ–ï–ù–ò–Ø.', ''))

    cp('headline.appl', (p_r_f_x, '–ü–†–ò–õ–û–ñ–ï–ù–ò–Ø', '–ö –î–û–ì–û–í–û–†–£'))

    # –†–ï–ö–í–ò–ó–ò–¢–´ –°–¢–û–†–û–ù
    cp('headline.addresses.1', (p_r_f_x, '–†–ï–ö–í–ò–ó–ò–¢–´ –°–¢–û–†–û–ù', '–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –ê–î–†–ï–°–ê'))
    cp('headline.addresses.2', (p_r_f_x, '–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –ê–î–†–ï–°–ê', '–†–ï–ö–í–ò–ó–ò–¢–´ –°–¢–û–†–û–ù'))

    cp('headline.conficts', (p_r_f_x, '–°–ø–æ—Ä—ã –∏ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è.', ''))

  def _build_sum_patterns(self):
    def cp(name, tuples):
      return self.create_pattern(name, tuples)

    suffix = '(–º–ª–Ω. —Ç—ã—Å. –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ç—ã—Å—è—á —Ä—É–±–ª–µ–π –¥–æ–ª–ª–∞—Ä–æ–≤ –∫–æ–ø–µ–µ–∫ –µ–≤—Ä–æ)'

    cp('_phrase.1', ('–æ–±—â–∞—è', '—Å—É–º–º–∞', '–¥–æ–≥–æ–≤–æ—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç'))

    cp('_sum.work.1', ('–°—Ç–æ–∏–º–æ—Å—Ç—å –†–∞–±–æ—Ç —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç', '0 —Ä—É–±–ª–µ–π', suffix))
    cp('_sum.work.2', ('–†–∞—Å—á–µ—Ç—ã –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É. –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–∫–∞–∑—ã–≤–∞–µ–º—ã—Ö —É—Å–ª—É–≥ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ', '0', suffix))
    cp('_sum.work.3', ('–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å', '0', suffix))
    cp('_sum.work.4', ('–ø–æ—Å–ª–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Å—É–º–º—É –≤ —Ä–∞–∑–º–µ—Ä–µ', '0', suffix))
    cp('_sum.work.5', ('–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç', '0', suffix))

    cp('sum_neg.phone', ('—Ç–µ–ª–µ—Ñ–æ–Ω', '00-00-00', ''))

    cp('sum_neg.penalty', ('—É–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è', '—à—Ç—Ä–∞—Ñ', '0 —Ä—É–±–ª–µ–π –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–º–µ—â–∞—é—Ç—Å—è –ø–æ–Ω–µ—Å–µ–Ω–Ω—ã–µ —É–±—ã—Ç–∫–∏'))
    cp('sum_neg.3', (
      '–í —Å–ª—É—á–∞–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è  —Å—Ä–æ–∫–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –†–∞–±–æ—Ç –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é , –ó–∞–∫–∞–∑—á–∏–∫ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –≤–∑—ã—Å–∫–∞—Ç—å –ø–µ–Ω–∏ –≤ —Ä–∞–∑–º–µ—Ä–µ',
      '0%', '–æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –≤–æ–≤—Ä–µ–º—è —ç—Ç–∞–ø–∞ –†–∞–±–æ—Ç –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏'))
    cp('sum_neg.date.1', ('–≤ —Å—Ä–æ–∫ –Ω–µ –ø–æ–∑–¥–Ω–µ–µ, —á–µ–º –∑–∞ 0 –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö', '–∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö', ' –¥–Ω–µ–π'))
    cp('sum_neg.vat', ('–≤ —Ç–æ–º —á–∏—Å–ª–µ', '–ù–î–°', '0 ' + suffix))
    cp('sum_neg.date.2', ('–≤ —Ç–µ—á–µ–Ω–∏–µ', '0', '—Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π '))

  def make_contract_value_attention_vectors(self, subdoc):
    sumphrase_attention_vector = max_exclusive_pattern_by_prefix(subdoc.distances_per_pattern_dict, '_phrase')
    sumphrase_attention_vector = momentum(sumphrase_attention_vector, 0.99)

    value_attention_vector, _c1 = rectifyed_sum_by_pattern_prefix(subdoc.distances_per_pattern_dict, '_sum.work',
                                                                  relu_th=0.4)
    value_attention_vector = cut_above(value_attention_vector, 1)
    value_attention_vector = relu(value_attention_vector, 0.6)
    value_attention_vector = momentum(value_attention_vector, 0.8)

    novalue_attention_vector = max_exclusive_pattern_by_prefix(subdoc.distances_per_pattern_dict, 'sum_neg')

    novalue_attention_vector_local_contrast = relu(novalue_attention_vector, 0.6)
    novalue_attention_vector_local_contrast = momentum(novalue_attention_vector_local_contrast, 0.9)

    value_attention_vector_tuned = (value_attention_vector - novalue_attention_vector * 0.7)

    value_attention_vector_tuned = (value_attention_vector_tuned + sumphrase_attention_vector) / 2
    value_attention_vector_tuned = relu(value_attention_vector_tuned, 0.2)

    return {
      'sumphrase_attention_vector': sumphrase_attention_vector,
      'value_attention_vector': value_attention_vector,
      'novalue_attention_vector': novalue_attention_vector,

      'novalue_attention_vector_local_contrast': novalue_attention_vector_local_contrast,
      'value_attention_vector_tuned': value_attention_vector_tuned,
    }

  def _build_subject_patterns(self):

    def cp(a, p, c=None):
      cnt = len(self.patterns)
      if c is None:
        c = ""
      return self.create_pattern(f'x_{subj}.{cnt}', (a, p, c))

    # ----------------------------------------------------------
    subj = ContractSubject.Charity
    if True:
      cp('–¥–æ–≥–æ–≤–æ—Ä',
         '–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ',
         '–ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è')

      cp('–¥–æ–≥–æ–≤–æ—Ä –æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏',
         '–±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ–π –ø–æ–º–æ—â–∏',
         '—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π')

      cp('–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å',
         '–ë–ª–∞–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª—é',
         '–≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–≥–æ')

      cp('–ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ',
         '–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö',
         '')

      cp('', '–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å', '')
      cp('', '–ë–ª–∞–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª—å', '')

      cp('–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ',
         '–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è',
         '')

      cp('',
         '–ñ–µ—Ä—Ç–≤–æ–≤–∞—Ç–µ–ª—å',
         '–±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –∞ –ë–ª–∞–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç')

      cp('–ñ–µ—Ä—Ç–≤–æ–≤–∞—Ç–µ–ª—å', '–±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ', '')

    # ----------------------------------------------------------
    subj = ContractSubject.Service
    if True:
      # TODO: üö∑ sorry, order matters!!! do not üö∑ touch

      #     cp('–ü–†–û–î–ê–í–ï–¶ –æ–±—è–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ü–û–ö–£–ü–ê–¢–ï–õ–Ø, –∞', '–ü–û–ö–£–ü–ê–¢–ï–õ–¨', '–æ–±—è–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—è—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å')

      cp('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è —Å–≤–æ–∏–º–∏ —Å–∏–ª–∞–º–∏',
         '–≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—ã',
         '–ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')

      cp('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è',
         '–æ–∫–∞–∑–∞—Ç—å —É—Å–ª—É–≥–∏',
         '')

      cp('–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ —Å–µ–±—è',
         '–æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å',
         '')

      cp('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç ', '—É—Å–ª—É–≥–∏', '–≤ –≤–∏–¥–µ')
      cp('–¥–æ–≥–æ–≤–æ—Ä –Ω–∞ –æ–∫–∞–∑–∞–Ω–∏–µ', '–ø–ª–∞—Ç–Ω—ã—Ö', '—É—Å–ª—É–≥')
      cp('–ó–∞–∫–∞–∑—á–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∏—Ç—å', '—É—Å–ª—É–≥–∏', '')

    # ----------------------------------------------------------
    subj = ContractSubject.RealEstate
    if True:
      cp('–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è', '–æ–ø–ª–∞—Ç–∏—Ç—å –û–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ–≥–æ', '–∏–º—É—â–µ—Å—Ç–≤–∞')
      cp('–ü—Ä–æ–¥–∞–≤–µ—Ü –æ–±—è–∑—É–µ—Ç—Å—è', '–ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å',
         '–ü–æ–∫—É–ø–∞—Ç–µ–ª—è –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞ –∑–¥–∞–Ω–∏–µ, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–µ –ø–æ –∞–¥—Ä–µ—Å—É')
      cp('–ü—Ä–æ–¥–∞–≤–µ—Ü –æ–±—è–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '–Ω–µ–¥–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ', '–æ–±—ä–µ–∫—Ç—ã , –∑–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏')

    subj = ContractSubject.Loans
    if True:
      cp('–ó–∞–π–º–æ–¥–∞–≤–µ—Ü –ø–µ—Ä–µ–¥–∞–µ—Ç –ó–∞–µ–º—â–∏–∫—É', '–≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–π–º–∞', '–¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞')
      cp('', '–ó–∞–π–º–æ–¥–∞–≤–µ—Ü –ø–µ—Ä–µ–¥–∞–µ—Ç –ó–∞–µ–º—â–∏–∫—É', '–≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–π–º–∞ –¥–µ–Ω–µ–∂–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞')
      cp('–ó–∞–π–º–æ–¥–∞–≤–µ—Ü –ø–µ—Ä–µ–¥–∞–µ—Ç –ó–∞–µ–º—â–∏–∫—É', '—Ü–µ–ª–µ–≤–æ–π –∑–∞–µ–º', '—Ç—Ä–∞–Ω—à–∞–º–∏ –Ω–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–æ–π –æ—Å–Ω–æ–≤–µ')
      cp('–ó–∞–µ–º—â–∏–∫ –æ–±—è–∑—É–µ—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å —É–∫–∞–∑–∞–Ω–Ω—É—é', '—Å—É–º–º—É –∑–∞–π–º–∞', '–≤–º–µ—Å—Ç–µ —Å –ø—Ä–∏—á–∏—Ç–∞—é—â–∏–º–∏—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏')

    subj = ContractSubject.PledgeEncumbrance
    if True:
      cp('–ó–∞–ª–æ–≥–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç, –∞', '–ó–∞–ª–æ–≥–æ–¥–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç –≤ –∑–∞–ª–æ–≥', '–≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è')

    subj = ContractSubject.Renting
    if True:
      cp('–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å –ø–µ—Ä–µ–¥–∞–µ—Ç, –∞', '–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ –∞—Ä–µ–Ω–¥—É', '(–≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ) –∑–¥–∞–Ω–∏–µ')
      cp('', '–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å',
         '–æ–±—è–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—É –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–∞—Ä–µ–Ω–¥—É) –Ω–µ–¥–≤–∏–∂–∏–º–æ–µ –∏–º—É—â–µ—Å—Ç–≤–æ')

    subj = ContractSubject.AgencyContract
    if True:
      cp('', '–ê–≥–µ–Ω—Ç', '–æ–±—è–∑—É–µ—Ç—Å—è —Å–æ–≤–µ—Ä—à–∞—Ç—å –ø–æ –ø–æ—Ä—É—á–µ–Ω–∏—é –ü—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞')
